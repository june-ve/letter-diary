<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>LetterDiary - ë¡œê·¸ì¸</title>

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #e6ddcf; /* ì±…ìƒ ë°°ê²½ í†¤ */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .login-card {
            background: linear-gradient(145deg, #f7f0e7, #f0e0c9);
            padding: 32px 38px;
            border-radius: 18px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            width: 360px;
        }

        .login-title {
            font-size: 22px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 6px;
            color: #3b2f2f;
        }

        .login-subtitle {
            font-size: 14px;
            text-align: center;
            opacity: 0.75;
            margin-bottom: 22px;
        }

        .input-group {
            margin-bottom: 18px;
        }

        .input-label {
            font-size: 13px;
            margin-bottom: 6px;
            display: block;
            color: #4a3c3c;
        }

        input {
            width: 100%;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid rgba(0,0,0,0.15);
            background: #fdf7ea;
            font-size: 14px;
        }

        .btn-login {
            width: 100%;
            background: #b56d57;
            border: none;
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 15px;
            cursor: pointer;
            margin-top: 12px;
        }

        .btn-login:hover {
            background: #9e5641;
        }

        .btn-signup {
            width: 100%;
            background: #d3b8a1;
            border: none;
            color: #3b2f2f;
            padding: 10px;
            border-radius: 8px;
            font-size: 15px;
            cursor: pointer;
            margin-top: 10px;
        }

        .btn-signup:hover {
            background: #c3a992;
        }

        .error-message {
            font-size: 13px;
            color: #b74d37;
            margin-top: 8px;
            display: none;
            text-align: center;
        }

        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 18px;
            border-radius: 999px;
            font-size: 13px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-4px);
        }

        /* Signup Modal */
        .modal-bg {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.45);
            display: none;
            justify-content: center;
            align-items: center;
        }

        .modal {
            width: 360px;
            background: #fdf7ea;
            padding: 24px 28px;
            border-radius: 14px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 12px;
            text-align: center;
        }

        .modal-actions {
            margin-top: 18px;
            display: flex;
            gap: 10px;
        }

        .btn-cancel {
            flex: 1;
            background: #d0c2b4;
            border-radius: 8px;
            border: none;
            padding: 10px;
            font-size: 14px;
            cursor: pointer;
        }

        .btn-submit {
            flex: 1;
            background: #b56d57;
            border-radius: 8px;
            border: none;
            padding: 10px;
            font-size: 14px;
            color: white;
            cursor: pointer;
        }
    </style>
</head>

<body>

<script>
    const existingToken = localStorage.getItem("token");
    if (existingToken) {
        window.location.href = "/diary";
    }
</script>

<div class="login-card">
    <div class="login-title">LetterDiary</div>
    <div class="login-subtitle">ë”°ëœ»í•œ ë§ˆìŒì„ ê¸°ë¡í•˜ëŠ” ê³µê°„</div>

    <!-- ë¡œê·¸ì¸ í¼ -->
    <div>
        <div class="input-group">
            <label class="input-label">ì´ë©”ì¼</label>
            <input type="email" id="email" placeholder="your@email.com">
        </div>

        <div class="input-group">
            <label class="input-label">ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" id="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>

        <button class="btn-login" id="loginBtn">ë¡œê·¸ì¸</button>

        <button class="btn-signup" id="openSignupModal">íšŒì›ê°€ì…</button>

        <div class="error-message" id="errorMessage">ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
    </div>
</div>

<!-- Signup Modal -->
<div class="modal-bg" id="signupModal">
    <div class="modal">
        <div class="modal-title">íšŒì›ê°€ì…</div>

        <div class="input-group">
            <label class="input-label">ì´ë©”ì¼</label>
            <input type="email" id="signupEmail">
        </div>

        <div class="input-group">
            <label class="input-label">ë¹„ë°€ë²ˆí˜¸ (8~20ì)</label>
            <input type="password" id="signupPassword">
        </div>

        <div class="input-group">
            <label class="input-label">ë‹‰ë„¤ì„</label>
            <input type="text" id="signupNickname">
        </div>

        <div class="modal-actions">
            <button class="btn-cancel" id="closeSignupModal">ì·¨ì†Œ</button>
            <button class="btn-submit" id="submitSignup">ê°€ì…í•˜ê¸°</button>
        </div>

        <div class="error-message" id="signupError"></div>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
    const loginBtn = document.getElementById("loginBtn");
    const errorMessage = document.getElementById("errorMessage");
    const toast = document.getElementById("toast");

    function showToast(message) {
        toast.textContent = message;
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 2000);
    }

    /* ------------------ ë¡œê·¸ì¸ ------------------ */
    loginBtn.addEventListener("click", async () => {
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();

        if (!email || !password) {
            errorMessage.style.display = "block";
            errorMessage.textContent = "ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
            return;
        }

        try {
            const response = await fetch("/api/auth/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password })
            });

            if (!response.ok) {
                errorMessage.style.display = "block";
                errorMessage.textContent = "ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
                return;
            }

            const data = await response.json();

            // JWT ì €ì¥
            localStorage.setItem("token", data.token);

            showToast("ë¡œê·¸ì¸ ì„±ê³µ! ì±…ìƒìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤ ğŸ’Œ");

            // 1ì´ˆ í›„ ì±…ìƒ í˜ì´ì§€ë¡œ ì´ë™
            setTimeout(() => {
                window.location.href = "/diary";   // ì±…ìƒ í˜ì´ì§€
            }, 800);

        } catch (err) {
            console.error(err);
            errorMessage.style.display = "block";
            errorMessage.textContent = "ì„œë²„ì™€ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
        }
    });

    /* ------------------ íšŒì›ê°€ì… ëª¨ë‹¬ ------------------ */
    const signupModal = document.getElementById("signupModal");
    const openSignupBtn = document.getElementById("openSignupModal");
    const closeSignupBtn = document.getElementById("closeSignupModal");
    const signupError = document.getElementById("signupError");

    openSignupBtn.onclick = () => signupModal.style.display = "flex";
    closeSignupBtn.onclick = () => {
        signupModal.style.display = "none";
        signupError.style.display = "none";
    };

    /* ------------------ íšŒì›ê°€ì… ìš”ì²­ ------------------ */
    document.getElementById("submitSignup").onclick = async () => {
        const email = document.getElementById("signupEmail").value.trim();
        const password = document.getElementById("signupPassword").value.trim();
        const nickname = document.getElementById("signupNickname").value.trim();

        if (!email || !password || !nickname) {
            signupError.style.display = "block";
            signupError.textContent = "ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
            return;
        }

        const res = await fetch("/api/auth/signup", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password, nickname })
        });

        if (res.ok) {
            showToast("íšŒì›ê°€ì… ì™„ë£Œ! ì´ì œ ë¡œê·¸ì¸í•˜ì„¸ìš” âœ¨");
            signupModal.style.display = "none";
            return;
        }

        const errData = await res.json();
        signupError.style.display = "block";
        signupError.textContent = errData.message || "íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
    };
</script>

</body>
</html>
